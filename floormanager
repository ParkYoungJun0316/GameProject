using UnityEngine;
using System.Collections.Generic;

public class FloorManager : MonoBehaviour
{
    public float changeInterval = 2f;

    [Range(0f, 1f)] public float keepBWRatio = 0.8f; // 흑/백 유지 비율 (0.8이면 80%는 흑/백)
    FloorTile[] tiles;

    float nextTime;

    void Awake()
    {
        tiles = GetComponentsInChildren<FloorTile>(true);
    }

    void Update()
    {
        if (Time.time < nextTime) return;
        nextTime = Time.time + changeInterval;

        RandomizeTiles();
    }

    void RandomizeTiles()
    {
        if (tiles == null || tiles.Length == 0) return;

        for (int i = 0; i < tiles.Length; i++)
        {
            bool useBW = Random.value < keepBWRatio;

            if (useBW)
            {
                // 흑/백 랜덤
                tiles[i].SetType(Random.value < 0.5f ? FloorTile.ColorType.Black : FloorTile.ColorType.White);
            }
            else
            {
                // 초록
                tiles[i].SetType(FloorTile.ColorType.Reveal);
            }
        }
    }
}


using UnityEngine;

public class FloorTile : MonoBehaviour
{
    public enum ColorType { Black, White, Reveal }
    public ColorType type;

    [Header("Tile Colors (Inspector)")]
    public Color blackColor = Color.black;
    public Color whiteColor = Color.white;
    public Color revealTileColor = new Color(0.12f, 0.25f, 0.18f);

    static readonly int BaseColorId = Shader.PropertyToID("_BaseColor");
    static readonly int ColorId = Shader.PropertyToID("_Color");

    MaterialPropertyBlock mpb;
    Renderer rend;

    void Awake()
    {
        rend = GetComponent<Renderer>();
        mpb = new MaterialPropertyBlock();
        ApplyColor();
    }

    public void SetType(ColorType t)
    {
        type = t;
        ApplyColor();
    }

    void ApplyColor()
    {
        if (rend == null) return;

        Color c = type switch
        {
            ColorType.Black => blackColor,
            ColorType.White => whiteColor,
            ColorType.Reveal => revealTileColor, 
            _ => whiteColor
        };

        rend.GetPropertyBlock(mpb);
        mpb.SetColor(BaseColorId, c);
        mpb.SetColor(ColorId, c);
        rend.SetPropertyBlock(mpb);
    }
}
